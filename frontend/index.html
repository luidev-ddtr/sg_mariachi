<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mariachis San Nicolás</title>

  <!-- Google Material Icons -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">

  <!-- codigo de Archivo CSS -->
  <link rel="stylesheet" href="/src/styles/style_index.css">
</head>

<body>
 
    <aside class="sidebar">
      <div class="sidebar-top">
        <!-- Logo -->
        <div class="logo-container">
               <img src="images/logo_cn_fondo.png" 
               alt="Logo Mariachis" class="logo">
          <!--<h2 class="logo-text">Mariachis<br>San Nicolás</h2>-->
        </div>

      
        <nav class="menu">

          <a href="/pages/control_panel.html" target="contenido" class="menu-item">
            <span class="material-symbols-outlined">dashboard</span>
            <span class="text_nav">Panel de control</span>
          </a>

          <a href="/pages/agenda.html" target="contenido" class="menu-item">
            <span class="material-symbols-outlined">event</span>
            <span class="text_nav">Agenda</span>
          </a>

          <a href="/pages/registro-evento.html" target="contenido" class="menu-item">
            <span class="material-symbols-outlined">assignment</span>
            <span class="text_nav">Eventos</span>
          </a>

          <a href="/pages/generate_reports.html" target="contenido" class="menu-item">
            <span class="material-symbols-outlined">bar_chart</span>
            <span class="text_nav">Reportes</span>
          </a>

        </nav>
      </div>

      <!-- Botón de salida -->
      <div class="sidebar-bottom">
        <a href="#" id="logoutBtn" class="logout-btn">
          <span class="material-symbols-outlined">logout</span>
          <span>Salir</span>
        </a>
      </div>
    </aside>

    <main class="main-content">
      <iframe name="contenido" src="/pages/control_panel.html" class="iframe-content"></iframe>
    </main>

  <script type="module">
    import { checkSession, logoutUser } from './src/api/api_auth.js';

    document.addEventListener('DOMContentLoaded', async () => {
      // 1. PROTECCIÓN: Verificar si hay sesión activa al entrar
      const session = await checkSession();
      // Si no hay sesión o el status no es success/200, expulsamos al usuario
      if (!session || (session.status !== 'success' && session.status !== 200)) {
        window.location.href = '/pages/login.html';
        return;
      }

      // 2. FUNCIONALIDAD LOGOUT: Conectar el botón con la API
      const btnLogout = document.getElementById('logoutBtn');
      if (btnLogout) {
        btnLogout.addEventListener('click', async (e) => {
          e.preventDefault(); // Evita que el enlace navegue por sí solo
          await logoutUser(); // Llama al backend para destruir la sesión y redirige
        });
      }
    });
  </script>
</body>
</html>
